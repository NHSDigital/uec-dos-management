name: Test Truncate Workflow History

on:
  push:
    branches:
      # - main
      - v0.45
#   # schedule:
#   #   - cron: '0 1 * * *'
#   # Run daily, at 01:00 .

jobs:


  test_delete_past_runs:
    name: "Apply Deploy Infrastructure"
    permissions:
      id-token: write
      contents: read
    uses: ./.github/workflows/truncate-workflow-history.yaml
    with:
      domain: "uec-dos-management"
      retain_days: 25
      minimum_history: 100
    secrets: inherit

  slack-notifications:
    needs: [
      test_delete_past_runs,
    ]
    if: always()
    uses: ./.github/workflows/slack-notifications.yaml
    with:
      env: mgmt
    secrets: inherit
