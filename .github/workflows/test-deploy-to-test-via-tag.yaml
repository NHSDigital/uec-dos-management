name: Test Deploy to test via tag

on:
  push:
    branches:
      - main
      - 'task/*'

jobs:
  metadata:
    name: "Get Metadata"
    uses: ./.github/workflows/metadata.yaml
  tag-repository:
    name: "Tag Repository"
    # if: ${{ github.event.label.name == 'Test Ready' }} && startswith(github.head_ref, 'task/')
    needs:
      [
        metadata,
      ]
    uses: ./.github/workflows/tag-repository.yaml
    with:
      workspace: ${{ needs.metadata.outputs.workspace }}
      tag_type: test
      use_commit_hash: "no"
      tag_overwrite: "yes"
